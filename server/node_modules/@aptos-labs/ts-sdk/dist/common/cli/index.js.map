{"version":3,"sources":["../../../src/cli/localNode.ts","../../../src/cli/move.ts"],"names":["spawn","kill","platform","LocalNode","resolve","reject","err","cliCommand","cliArgs","currentPlatform","childProcess","data","str","operational","start","last","sleep","Move","args","network","profile","extraArguments","packageDirectoryPath","namedAddresses","addressesMap","addressName","result","objectAddress","outputFile","compiledScriptPath","stdout","code","totalNames","newArgs","names","value","key","toAppend","address","output","match"],"mappings":"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","sourcesContent":["import { ChildProcessWithoutNullStreams, spawn } from \"child_process\";\nimport kill from \"tree-kill\";\nimport { platform } from \"os\";\n\nimport { sleep } from \"../utils/helpers\";\n\nexport class LocalNode {\n  readonly MAXIMUM_WAIT_TIME_SEC = 75;\n\n  readonly READINESS_ENDPOINT = \"http://127.0.0.1:8070/\";\n\n  process: ChildProcessWithoutNullStreams | null = null;\n\n  /**\n   * kills all the descendent processes\n   * of the node process, including the node process itself\n   */\n  async stop() {\n    await new Promise((resolve, reject) => {\n      if (!this.process?.pid) return;\n      kill(this.process.pid, (err) => {\n        if (err) {\n          reject(err);\n        } else {\n          resolve(true);\n        }\n      });\n    });\n  }\n\n  /**\n   * Runs a local testnet and waits for process to be up.\n   *\n   * If local node process is already up it returns and does\n   * not start the process\n   */\n  async run() {\n    const nodeIsUp = await this.checkIfProcessIsUp();\n    if (nodeIsUp) {\n      return;\n    }\n    this.start();\n    await this.waitUntilProcessIsUp();\n  }\n\n  /**\n   * Starts the local testnet by running the aptos node run-local-testnet command\n   */\n  start() {\n    const cliCommand = \"npx\";\n    const cliArgs = [\"aptos\", \"node\", \"run-localnet\", \"--force-restart\", \"--assume-yes\", \"--with-indexer-api\"];\n\n    const currentPlatform = platform();\n    let childProcess;\n    // Check if current OS is windows\n    if (currentPlatform === \"win32\") {\n      childProcess = spawn(cliCommand, cliArgs, { shell: true });\n    } else {\n      childProcess = spawn(cliCommand, cliArgs);\n    }\n\n    this.process = childProcess;\n\n    childProcess.stderr?.on(\"data\", (data: any) => {\n      const str = data.toString();\n      // Print local node output log\n      // eslint-disable-next-line no-console\n      console.log(str);\n    });\n\n    childProcess.stdout?.on(\"data\", (data: any) => {\n      const str = data.toString();\n      // Print local node output log\n      // eslint-disable-next-line no-console\n      console.log(str);\n    });\n  }\n\n  /**\n   * Waits for the local testnet process to be up\n   *\n   * @returns Promise<boolean>\n   */\n  async waitUntilProcessIsUp(): Promise<boolean> {\n    let operational = await this.checkIfProcessIsUp();\n    const start = Date.now() / 1000;\n    let last = start;\n\n    while (!operational && start + this.MAXIMUM_WAIT_TIME_SEC > last) {\n      // eslint-disable-next-line no-await-in-loop\n      await sleep(1000);\n      // eslint-disable-next-line no-await-in-loop\n      operational = await this.checkIfProcessIsUp();\n      last = Date.now() / 1000;\n    }\n\n    // If we are here it means something blocks the process to start.\n    // Might worth checking if another process is running on port 8080\n    if (!operational) {\n      throw new Error(\"Process failed to start\");\n    }\n\n    return true;\n  }\n\n  /**\n   * Checks if the local testnet is up\n   *\n   * @returns Promise<boolean>\n   */\n  async checkIfProcessIsUp(): Promise<boolean> {\n    try {\n      // Query readiness endpoint\n      const data = await fetch(this.READINESS_ENDPOINT);\n      if (data.status === 200) {\n        return true;\n      }\n      return false;\n    } catch (err: any) {\n      return false;\n    }\n  }\n}\n","import { spawn } from \"child_process\";\nimport { platform } from \"os\";\n\nimport { AccountAddress } from \"../core\";\nimport { Network } from \"../utils\";\n\nexport class Move {\n  /**\n   * Function to initialize current directory for Aptos\n   *\n   * Configuration will be pushed into .aptos/config.yaml\n   * @param args.network optional Network type argument to use for default settings, default is local\n   * @param args.profile optional Profile to use from the config file, default is 'default'\n   * This will be used to override associated settings such as the REST URL, the Faucet URL, and the private key arguments.\n   * @param args.extraArguments (optional) Any extra arguments to include in the form of an array of strings\n   * @example\n   * [\"--assume-yes\",\"--gas-unit-price=10\"]\n   *\n   * @returns stdout\n   */\n  async init(args: {\n    network?: Network;\n    profile?: string;\n    extraArguments?: Array<string>;\n  }): Promise<{ output: string }> {\n    const { network, profile, extraArguments } = args;\n    const cliArgs = [\"aptos\", \"init\", `--network=${network ?? \"local\"}`, `--profile=${profile ?? \"default\"}`];\n\n    if (extraArguments) {\n      cliArgs.push(...extraArguments);\n    }\n\n    return this.runCommand(cliArgs);\n  }\n\n  /**\n   * Function to compile a package\n   *\n   * @param args.packageDirectoryPath Path to a move package (the folder with a Move.toml file)\n   * @param args.namedAddresses  Named addresses for the move binary\n   * @param args.extraArguments (optional) Any extra arguments to include in the form of an array of strings\n   * @example\n   * [\"--assume-yes\",\"--gas-unit-price=10\"]\n   * @example\n   * {\n   *  alice:0x1234, bob:0x5678\n   * }\n   *\n   * @returns stdout\n   */\n  async compile(args: {\n    packageDirectoryPath: string;\n    namedAddresses: Record<string, AccountAddress>;\n    extraArguments?: Array<string>;\n  }): Promise<{ output: string }> {\n    const { packageDirectoryPath, namedAddresses, extraArguments } = args;\n    const cliArgs = [\"aptos\", \"move\", \"compile\", \"--package-dir\", packageDirectoryPath];\n\n    const addressesMap = this.parseNamedAddresses(namedAddresses);\n\n    cliArgs.push(...this.prepareNamedAddresses(addressesMap));\n\n    if (extraArguments) {\n      cliArgs.push(...extraArguments);\n    }\n\n    return this.runCommand(cliArgs);\n  }\n\n  /**\n   * Function to run Move unit tests for a package\n   *\n   * @param args.packageDirectoryPath Path to a move package (the folder with a Move.toml file)\n   * @param args.namedAddresses  Named addresses for the move binary\n   * @example\n   * {\n   *  alice:0x1234, bob:0x5678\n   * }\n   * @param args.extraArguments (optional) Any extra arguments to include in the form of an array of strings\n   * @example\n   * [\"--assume-yes\",\"--gas-unit-price=10\"]\n   *\n   * @returns stdout\n   */\n  async test(args: {\n    packageDirectoryPath: string;\n    namedAddresses: Record<string, AccountAddress>;\n    extraArguments?: Array<string>;\n  }): Promise<{ output: string }> {\n    const { packageDirectoryPath, namedAddresses, extraArguments } = args;\n    const cliArgs = [\"aptos\", \"move\", \"test\", \"--package-dir\", packageDirectoryPath];\n\n    const addressesMap = this.parseNamedAddresses(namedAddresses);\n\n    cliArgs.push(...this.prepareNamedAddresses(addressesMap));\n\n    if (extraArguments) {\n      cliArgs.push(...extraArguments);\n    }\n\n    return this.runCommand(cliArgs);\n  }\n\n  /**\n   * Function to publish the modules to the publisher account on the Aptos blockchain\n   *\n   * @param args.packageDirectoryPath Path to a move package (the folder with a Move.toml file)\n   * @param args.namedAddresses  Named addresses for the move binary\n   * @example\n   * {\n   *  alice:0x1234, bob:0x5678\n   * }\n   * @param args.profile optional Profile to use from the config file.\n   * @param args.extraArguments (optional) Any extra arguments to include in the form of an array of strings\n   * @example\n   * [\"--assume-yes\",\"--gas-unit-price=10\"]\n   *\n   * @returns stdout\n   */\n  async publish(args: {\n    packageDirectoryPath: string;\n    namedAddresses: Record<string, AccountAddress>;\n    profile?: string;\n    extraArguments?: Array<string>;\n  }): Promise<{ output: string }> {\n    const { packageDirectoryPath, namedAddresses, profile, extraArguments } = args;\n    const cliArgs = [\n      \"aptos\",\n      \"move\",\n      \"publish\",\n      \"--package-dir\",\n      packageDirectoryPath,\n      `--profile=${profile ?? \"default\"}`,\n    ];\n\n    const addressesMap = this.parseNamedAddresses(namedAddresses);\n\n    cliArgs.push(...this.prepareNamedAddresses(addressesMap));\n\n    if (extraArguments) {\n      cliArgs.push(...extraArguments);\n    }\n\n    return this.runCommand(cliArgs);\n  }\n\n  /**\n   * Function to create a new object and publish the Move package to it on the Aptos blockchain\n   *\n   * @param args.packageDirectoryPath Path to a move package (the folder with a Move.toml file)\n   * @param args.addressName Address name for the Move package\n   * @example\n   * MoonCoin, please find the actual address name in Move.toml\n   * @param args.namedAddresses  Named addresses for the move binary\n   * @example\n   * {\n   *  alice:0x1234, bob:0x5678\n   * }\n   * @param args.profile optional Profile to use from the config file.\n   * @param args.extraArguments (optional) Any extra arguments to include in the form of an array of strings\n   * @example\n   * [\"--assume-yes\",\"--gas-unit-price=10\"]\n   *\n   * A complete example in cli\n   * aptos move create-object-and-publish-package \\\n   * --package-dir path_to_directory_that_has_move.toml \\\n   * --address-name launchpad_addr \\\n   * --named-addresses \"launchpad_addr=0x123,initial_creator_addr=0x456\"\\\n   * --profile my_profile \\\n   * --assume-yes\n   * @returns object address\n   */\n  async createObjectAndPublishPackage(args: {\n    packageDirectoryPath: string;\n    addressName: string;\n    namedAddresses: Record<string, AccountAddress>;\n    profile?: string;\n    extraArguments?: Array<string>;\n  }): Promise<{ objectAddress: string }> {\n    const { packageDirectoryPath, addressName, namedAddresses, profile, extraArguments } = args;\n    const cliArgs = [\n      \"aptos\",\n      \"move\",\n      \"create-object-and-publish-package\",\n      \"--package-dir\",\n      packageDirectoryPath,\n      \"--address-name\",\n      addressName,\n      `--profile=${profile ?? \"default\"}`,\n    ];\n\n    const addressesMap = this.parseNamedAddresses(namedAddresses);\n\n    cliArgs.push(...this.prepareNamedAddresses(addressesMap));\n\n    if (extraArguments) {\n      cliArgs.push(...extraArguments);\n    }\n\n    const result = await this.runCommand(cliArgs);\n    return { objectAddress: this.extractAddressFromOutput(result.output) };\n  }\n\n  /**\n   * Function to upgrade a Move package previously published to an object on the Aptos blockchain\n   * Caller must be the object owner to call this function\n   *\n   * @param args.packageDirectoryPath Path to a move package (the folder with a Move.toml file)\n   * @param args.objectAddress Address of the object that the Move package published to\n   * @example\n   * 0x1000\n   * @param args.namedAddresses  Named addresses for the move binary\n   * @example\n   * {\n   *  alice:0x1234, bob:0x5678\n   * }\n   * @param args.profile optional Profile to use from the config file.\n   * @param args.extraArguments (optional) Any extra arguments to include in the form of an array of strings\n   * @example\n   * [\"--assume-yes\",\"--gas-unit-price=10\"]\n   *\n   * @returns stdout\n   */\n  async upgradeObjectPackage(args: {\n    packageDirectoryPath: string;\n    objectAddress: string;\n    namedAddresses: Record<string, AccountAddress>;\n    profile?: string;\n    extraArguments?: Array<string>;\n  }): Promise<{ output: string }> {\n    const { packageDirectoryPath, objectAddress, namedAddresses, profile, extraArguments } = args;\n    const cliArgs = [\n      \"aptos\",\n      \"move\",\n      \"upgrade-object-package\",\n      \"--package-dir\",\n      packageDirectoryPath,\n      \"--object-address\",\n      objectAddress,\n      `--profile=${profile ?? \"default\"}`,\n    ];\n\n    const addressesMap = this.parseNamedAddresses(namedAddresses);\n\n    cliArgs.push(...this.prepareNamedAddresses(addressesMap));\n\n    if (extraArguments) {\n      cliArgs.push(...extraArguments);\n    }\n\n    return this.runCommand(cliArgs);\n  }\n\n  /**\n   * Build a publication transaction payload and store it in a JSON output file\n   *\n   * @param args.packageDirectoryPath Path to a move package (the folder with a Move.toml file)\n   * @param args.outputFile Output file to write publication transaction to\n   * @param args.namedAddresses  Named addresses for the move binary\n   * @example\n   * {\n   *  alice:0x1234, bob:0x5678\n   * }\n   * @param args.extraArguments (optional) Any extra arguments to include in the form of an array of strings\n   * @example\n   * [\"--assume-yes\",\"--gas-unit-price=10\"]\n   *\n   * @returns stdout\n   */\n  async buildPublishPayload(args: {\n    packageDirectoryPath: string;\n    outputFile: string;\n    namedAddresses: Record<string, AccountAddress>;\n    extraArguments?: Array<string>;\n  }) {\n    const { outputFile, packageDirectoryPath, namedAddresses, extraArguments } = args;\n    const cliArgs = [\n      \"aptos\",\n      \"move\",\n      \"build-publish-payload\",\n      \"--json-output-file\",\n      outputFile,\n      \"--package-dir\",\n      packageDirectoryPath,\n    ];\n\n    const addressesMap = this.parseNamedAddresses(namedAddresses);\n\n    cliArgs.push(...this.prepareNamedAddresses(addressesMap));\n\n    if (extraArguments) {\n      cliArgs.push(...extraArguments);\n    }\n\n    return this.runCommand(cliArgs);\n  }\n\n  /**\n   * Function to run a Move script, please run compile before running this\n   *\n   * @param args.compiledScriptPath Path to a compiled Move script bytecode file\n   * @param args.namedAddresses  Named addresses for the move binary\n   * @example\n   * build/my_package/bytecode_scripts/my_move_script.mv\n   * @param args.profile optional Profile to use from the config file.\n   * @param args.extraArguments (optional) Any extra arguments to include in the form of an array of strings\n   * @example\n   * [\"--assume-yes\",\"--gas-unit-price=10\"]\n   *\n   * @returns stdout\n   */\n  async runScript(args: {\n    compiledScriptPath: string;\n    profile?: string;\n    extraArguments?: Array<string>;\n  }): Promise<{ output: string }> {\n    const { compiledScriptPath, profile, extraArguments } = args;\n    const cliArgs = [\n      \"aptos\",\n      \"move\",\n      \"run-script\",\n      \"--compiled-script-path\",\n      compiledScriptPath,\n      `--profile=${profile ?? \"default\"}`,\n    ];\n\n    if (extraArguments) {\n      cliArgs.push(...extraArguments);\n    }\n\n    return this.runCommand(cliArgs);\n  }\n\n  /**\n   * Run a move command\n   *\n   * @param args\n   * @returns stdout\n   */\n  // eslint-disable-next-line class-methods-use-this\n  private async runCommand(args: Array<string>): Promise<{ output: string }> {\n    return new Promise((resolve, reject) => {\n      const currentPlatform = platform();\n      let childProcess;\n      let stdout = \"\";\n\n      // Check if current OS is windows\n      if (currentPlatform === \"win32\") {\n        childProcess = spawn(\"npx\", args, { shell: true });\n      } else {\n        childProcess = spawn(\"npx\", args);\n      }\n\n      childProcess.stdout.on(\"data\", (data) => {\n        stdout += data.toString();\n      });\n\n      childProcess.stdout.pipe(process.stdout);\n      childProcess.stderr.pipe(process.stderr);\n      process.stdin.pipe(childProcess.stdin);\n\n      childProcess.on(\"close\", (code) => {\n        if (code === 0) {\n          resolve({ output: stdout }); // Resolve with stdout if the child process exits successfully\n        } else {\n          reject(new Error(`Child process exited with code ${code}`)); // Reject with an error if the child process exits with an error code\n        }\n      });\n    });\n  }\n\n  /**\n   * Convert named addresses from a Map into an array seperated by a comma\n   *\n   * @example\n   * input: {'alice' => '0x123', 'bob' => '0x456'}\n   * output: \"alice=0x123,bob=0x456\"\n   *\n   * @param namedAddresses\n   * @returns An array of names addresses seperated by a comma\n   */\n  // eslint-disable-next-line class-methods-use-this\n  private prepareNamedAddresses(namedAddresses: Map<string, AccountAddress>): Array<string> {\n    const totalNames = namedAddresses.size;\n    const newArgs: Array<string> = [];\n\n    if (totalNames === 0) {\n      return newArgs;\n    }\n\n    newArgs.push(\"--named-addresses\");\n\n    const names: Array<string> = [];\n    namedAddresses.forEach((value, key) => {\n      const toAppend = `${key}=${value.toString()}`;\n      names.push(toAppend);\n    });\n    newArgs.push(names.join(\",\"));\n    return newArgs;\n  }\n\n  /**\n   * Parse named addresses from a Record type into a Map\n   *\n   * @param namedAddresses\n   * @returns Map<name,address>\n   */\n  // eslint-disable-next-line class-methods-use-this\n  private parseNamedAddresses(namedAddresses: Record<string, AccountAddress>): Map<string, AccountAddress> {\n    const addressesMap = new Map();\n\n    Object.keys(namedAddresses).forEach((key) => {\n      const address = namedAddresses[key];\n      addressesMap.set(key, address);\n    });\n\n    return addressesMap;\n  }\n\n  /**\n   * Extract object address from the output\n   *\n   * @param output\n   * @returns object address\n   */\n  // eslint-disable-next-line class-methods-use-this\n  private extractAddressFromOutput(output: string): string {\n    const match = output.match(\"Code was successfully deployed to object address (0x[0-9a-fA-F]+)\\\\.\");\n    if (match) {\n      return match[1];\n    }\n    throw new Error(\"Failed to extract object address from output\");\n  }\n}\n"]}